# 資料夾儲存功能測試結果

## 測試日期
2025-06-03

## 功能描述
修改Chrome擴展功能，讓每次截取的內容（截圖和表格資料）都存儲到一個專門的資料夾中，提高文件組織性。

## 修改內容

### 1. 資料夾命名規則
- 格式：`醫療資料擷取_[時間戳]`
- 時間戳格式：ISO 8601 格式，替換特殊字符為連字符
- 範例：`醫療資料擷取_2025-06-03T01-55-06-474Z`

### 2. 檔案結構
每次擷取會在下載目錄中創建一個專門的資料夾，包含以下檔案：
```
醫療資料擷取_2025-06-03T01-55-06-474Z/
├── medical-data-2025-06-03T01-55-06-474Z.png  (截圖)
├── medical-data-2025-06-03T01-55-06-474Z.csv  (表格資料)
└── info.txt                                    (說明文件)
```

### 3. 說明文件內容
自動生成的 `info.txt` 包含：
- 擷取時間（本地時區）
- 網站標題和網址
- 檔案清單
- 表格資料摘要（欄位數量、記錄數量、欄位名稱）
- 工具版本信息

## 代碼修改

### background.js 主要修改
1. **captureAndExtractData 函數**
   - 新增 `folderName` 變數
   - 修改 `saveScreenshot` 和 `saveTableData` 調用，傳入資料夾名稱
   - 新增 `createInfoFile` 調用

2. **saveScreenshot 函數**
   - 新增 `folderName` 參數
   - 修改檔案路徑為 `${folderName}/${filename}.png`

3. **saveTableData 函數**
   - 新增 `folderName` 參數
   - 修改檔案路徑為 `${folderName}/${filename}.csv`

4. **新增 createInfoFile 函數**
   - 生成詳細的說明文件內容
   - 包含擷取時間、網站信息、檔案清單、資料摘要
   - 使用容錯機制，不影響主要功能

## 測試結果

### ✅ 資料夾命名測試
- 時間戳格式：`2025-06-03T01-55-06-474Z`
- 資料夾名稱：`醫療資料擷取_2025-06-03T01-55-06-474Z`
- 符合檔案系統命名規則

### ✅ 檔案路徑測試
- 截圖檔案：`醫療資料擷取_2025-06-03T01-55-06-474Z/medical-data-2025-06-03T01-55-06-474Z.png`
- CSV檔案：`醫療資料擷取_2025-06-03T01-55-06-474Z/medical-data-2025-06-03T01-55-06-474Z.csv`
- 說明檔案：`醫療資料擷取_2025-06-03T01-55-06-474Z/info.txt`

### ✅ 說明文件內容測試
```
醫療資料擷取說明
===================

擷取時間: 2025/6/3 上午9:55:06
網站標題: 健保醫療資訊雲端查詢系統 - 測試頁面
網站網址: file:///home/ubuntu/edgedata/test_page.html
檔案名稱: medical-data-2025-06-03T01-55-06-474Z

檔案清單:
- medical-data-2025-06-03T01-55-06-474Z.png (截圖)
- medical-data-2025-06-03T01-55-06-474Z.csv (表格資料，共 2 筆記錄)
- info.txt (本說明文件)

表格資料摘要:
欄位數量: 3
記錄數量: 2
欄位名稱: 項次, 就醫日期, 來源

擷取工具: 醫療資料一鍵擷取工具 v1.0.0
技術支援: Chrome Extension API
```

## 優點

### 1. 文件組織性
- 每次擷取的所有相關檔案都在同一個資料夾中
- 避免下載目錄混亂
- 便於管理和歸檔

### 2. 可追溯性
- 資料夾名稱包含時間戳，便於識別擷取時間
- 說明文件記錄詳細的擷取信息
- 包含網站來源和資料摘要

### 3. 完整性
- 截圖、資料和說明文件一應俱全
- 說明文件提供上下文信息
- 便於後續查閱和使用

### 4. 容錯性
- 說明文件創建失敗不會影響主要功能
- 保持向後相容性
- 錯誤處理完善

## 結論

✅ **所有測試項目均通過**

資料夾儲存功能已成功實現，能夠：
1. 自動創建有意義的資料夾名稱
2. 將所有相關檔案組織在同一資料夾中
3. 生成詳細的說明文件
4. 提供良好的用戶體驗和文件管理

**建議**：可以部署到生產環境使用。

